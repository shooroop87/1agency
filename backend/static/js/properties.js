!function(){"use strict";let e="/api/properties/",t={type:[],area:[],rooms:[],price:[],status:[]},l=1,r=!1;async function a(i=!1){if(r)return;r=!0;let n=document.getElementById("propertiesGrid");n?.classList.add("is-loading");let c=new URLSearchParams;Object.entries(t).forEach(([e,t])=>{t.forEach(t=>c.append(e,t))}),c.append("page",l);try{let s=await fetch(`${e}?${c}`),p=await s.json();(function e(t,l=!1){let r=document.getElementById("propertiesGrid");if(r){if(l||(r.innerHTML=""),0===t.length){r.innerHTML=`
        <div class="no-results">
          <p>No properties found matching your criteria</p>
          <button class="reset-filters-btn" onclick="window.PropertiesApp.resetFilters()">Reset filters</button>
        </div>
      `;return}t.forEach((e,t)=>{let l=t%4,a=document.createElement("a");a.href="#",a.className=`project-card project-card--lg${1===l?" project-card--align-end":""}`,a.dataset.id=e.id;let i=e.price_display?`<span class="tag">From ${e.price_display}</span>`:"";a.innerHTML=`
        <div class="pc-img" style="--img:url('${e.image}')">
          <div class="pc-tags">
            <span class="tag">${e.type||"Property"}</span>
            ${i}
          </div>
        </div>
        <div class="pc-meta">
          <h3 class="pc-title">
            <span class="dot" aria-hidden="true"></span>
            ${e.title}
            <i class="wdt-button__icon" aria-hidden="true"></i>
          </h3>
          <div class="pc-loc">${e.location||"Bali"}</div>
        </div>
      `,a.addEventListener("click",function(t){t.preventDefault(),o(e.id)}),r.appendChild(a)})}})(p.properties,i),function e(t){let r=document.getElementById("propertiesPagination");if(!r)return;if(t.pages<=1){r.innerHTML="";return}let i='<div class="pagination-wrapper">';t.has_prev&&(i+=`<button class="pagination-btn" data-page="${t.current_page-1}">←</button>`);for(let o=1;o<=t.pages;o++)o===t.current_page?i+=`<span class="pagination-btn active">${o}</span>`:o<=2||o>t.pages-1||1>=Math.abs(o-t.current_page)?i+=`<button class="pagination-btn" data-page="${o}">${o}</button>`:3===o&&t.current_page>4?i+='<span class="pagination-dots">...</span>':o===t.pages-1&&t.current_page<t.pages-3&&(i+='<span class="pagination-dots">...</span>');t.has_next&&(i+=`<button class="pagination-btn" data-page="${t.current_page+1}">→</button>`),i+="</div>",r.innerHTML=i,r.querySelectorAll("button[data-page]").forEach(e=>{e.addEventListener("click",function(){l=parseInt(this.dataset.page),a(),document.querySelector(".filters-section")?.scrollIntoView({behavior:"smooth"})})})}(p),function e(t){let l=document.querySelector(".projects-count");l&&(l.textContent=`${t} properties`)}(p.total)}catch(d){console.error("Error loading properties:",d)}finally{r=!1,n?.classList.remove("is-loading")}}function i(){let e=document.getElementById("filterModal");e&&(e.classList.remove("is-active"),document.body.style.overflow="")}async function o(t){let l=document.getElementById("propertyModal");if(l)try{let r=await fetch(`${e}${t}/`),a=await r.json();if(a.error){console.error(a.error);return}l.querySelector(".pm-title").textContent=a.title||"",l.querySelector(".pm-type").textContent=a.type||"",l.querySelector(".pm-developer").textContent=a.developer?`by ${a.developer}`:"",l.querySelector(".pm-image img").src=a.image||"",l.querySelector(".pm-location").innerHTML=a.location||"Bali";let i=[];a.completion&&i.push(`Completion: ${a.completion}`),a.status_display&&i.push(`Status: ${a.status_display}`),l.querySelector(".pm-construction").innerHTML=i.join("<br>")||"-",l.querySelector(".pm-roi").textContent=a.roi?`${a.roi}`:"Contact for details";let o=[];a.total_area&&o.push(`Total: ${a.total_area} m\xb2`),a.living_area&&o.push(`Living: ${a.living_area} m\xb2`),a.plot_area&&o.push(`Plot: ${a.plot_area} m\xb2`),l.querySelector(".pm-area").innerHTML=o.join("<br>")||"-",l.querySelector(".pm-leasehold").textContent=a.leasehold?`${a.leasehold} years`:"-",l.querySelector(".pm-view").textContent=a.view||"-";let n=l.querySelector(".pm-price-section");a.price?(n.style.display="block",l.querySelector(".pm-unit__type").textContent=a.type||"Unit",l.querySelector(".pm-unit__details").innerHTML=o.slice(0,2).join("<br>")||"",l.querySelector(".pm-unit__price").textContent=a.price_display||""):n.style.display="none",l.classList.add("is-active"),document.body.classList.add("modal-open"),document.body.style.overflow="hidden"}catch(c){console.error("Error loading property:",c)}}function n(){let e=document.getElementById("propertyModal");e&&(e.classList.remove("is-active"),document.body.classList.remove("modal-open"),document.body.style.overflow="")}document.addEventListener("DOMContentLoaded",function(){let e=document.getElementById("propertiesGrid");e&&(function e(){let l=document.querySelectorAll(".filters-desktop .filter-column[data-filter]");l.forEach(e=>{let l=e.dataset.filter,r=e.querySelectorAll('input[type="checkbox"]');r.forEach(r=>{r.addEventListener("change",function(){let r=this.value;if("all"===r)this.checked&&(e.querySelectorAll('input:not([value="all"])').forEach(e=>e.checked=!1),t[l]=[]);else{let a=e.querySelector('input[value="all"]');a&&(a.checked=!1),this.checked?t[l].includes(r)||t[l].push(r):t[l]=t[l].filter(e=>e!==r),0===t[l].length&&a&&(a.checked=!0)}})})})}(),function e(){let r=document.querySelectorAll(".filters-mobile .mobile-filter-item");r.forEach(e=>{let r=e.querySelector(".mobile-filter-select");r&&r.addEventListener("click",function(){(function e(r){let o=r.dataset.filter,n=r.querySelector("h6")?.textContent||o,c=document.querySelector(`.filters-desktop .filter-column[data-filter="${o}"]`),s=[];c&&c.querySelectorAll(".filter-checkbox").forEach(e=>{let l=e.querySelector("input"),r=e.querySelector(".label-text")?.textContent;l&&r&&s.push({value:l.value,label:r,checked:"all"===l.value?0===t[o].length:t[o].includes(l.value)})});let p=document.getElementById("filterModal");p||((p=document.createElement("div")).id="filterModal",p.className="filter-modal",document.body.appendChild(p)),p.innerHTML=`
      <div class="filter-modal__overlay"></div>
      <div class="filter-modal__content">
        <div class="filter-modal__header">
          <h3>${n}</h3>
          <button class="filter-modal__close">\xd7</button>
        </div>
        <div class="filter-modal__options">
          ${s.map(e=>`
            <label class="filter-checkbox">
              <input type="checkbox" value="${e.value}" ${e.checked?"checked":""}>
              <span class="checkmark"></span>
              <span class="label-text">${e.label}</span>
            </label>
          `).join("")}
        </div>
        <button class="filter-modal__apply wdt-button button-cta">Apply</button>
      </div>
    `,p.classList.add("is-active"),document.body.style.overflow="hidden",p.querySelector(".filter-modal__close").addEventListener("click",i),p.querySelector(".filter-modal__overlay").addEventListener("click",i),p.querySelector(".filter-modal__apply").addEventListener("click",function(){let e=p.querySelectorAll("input:checked"),s=Array.from(e).map(e=>e.value).filter(e=>"all"!==e);t[o]=s,c&&c.querySelectorAll('input[type="checkbox"]').forEach(e=>{"all"===e.value?e.checked=0===s.length:e.checked=s.includes(e.value)});let d=r.querySelector(".mobile-filter-select span");d&&(d.textContent=s.length?`${s.length} selected`:`All ${n.toLowerCase()}`),i(),l=1,a()})})(e)})})}(),function e(){let t=document.getElementById("propertyModal");t&&(t.querySelector(".property-modal__overlay")?.addEventListener("click",n),t.querySelector(".property-modal__close")?.addEventListener("click",n),document.addEventListener("keydown",function(e){"Escape"===e.key&&t.classList.contains("is-active")&&n()}))}(),document.querySelectorAll(".project-card[data-id]").forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();let t=this.dataset.id;t&&o(t)})}),function e(){let l=new URLSearchParams(window.location.search),r=!1;["type","area","rooms","price","status"].forEach(e=>{let a=l.get(e);if(a){r=!0;let i=document.querySelector(`[data-filter="${e}"] input[value="all"]`);i&&(i.checked=!1);let o=document.querySelector(`[data-filter="${e}"] input[value="${a}"]`);o&&(o.checked=!0,t[e].push(a));let n=document.querySelector(`.mobile-filter-item[data-filter="${e}"] .mobile-filter-select span`);if(n&&o){let c=o.closest(".filter-checkbox")?.querySelector(".label-text")?.textContent;c&&(n.textContent=c)}}}),r&&a()}(),document.getElementById("applyFilters")?.addEventListener("click",function(e){e.preventDefault(),l=1,a()}))}),window.PropertiesApp={loadProperties:a,resetFilters:function e(){t={type:[],area:[],rooms:[],price:[],status:[]},l=1,document.querySelectorAll(".filter-checkbox input").forEach(e=>{e.checked="all"===e.value}),document.querySelectorAll(".mobile-filter-select span").forEach(e=>{let t=e.closest(".mobile-filter-item"),l=t?.querySelector("h6")?.textContent||"";e.textContent=`All ${l.toLowerCase()}`}),window.history.replaceState({},"",window.location.pathname),a()},openPropertyModal:o,closeModal:n}}();
{% load static %}

<div id="page" class="mobilie_header_nav stylehome1">
  <div class="mobile-menu">
    <div class="header innerpage-style">
      <div class="menu_and_widgets">
        <div class="mobile_menu_bar d-flex justify-content-between align-items-center">

          <!-- Лого слева -->
          <a class="mobile_logo hero-brand" href="/">
            <img class="hero-mark" width="51" height="101"
                 src="https://andreyegorov.com/luxreal/wp-content/uploads/2025/10/479ca7c85bb1e2e8fdf70efdeb5d0b6e.png"
                 alt="One Agency">
            <span class="hero-name">One Agency</span>
          </a>

          <!-- Иконки справа -->
          <div class="mobile_menu_actions d-flex align-items-center">
            <!-- избранное -->
            <a href="#" class="favorites-btn" aria-label="Favorites">
              <img src="{% static 'images/save_icon.svg' %}" alt="Favorites" class="favorites-icon">
            </a>

            <!-- бургер (класс .menubar нужен mmenu) -->
            <a class="menubar mobile-burger" href="#menu" aria-label="Menu">
              <img src="{% static 'images/mobile_button.svg' %}" alt="Menu">
            </a>
          </div>

        </div>
      </div>
    </div>
  </div>

  <!-- сам контейнер меню для mmenu -->
  <nav id="menu">
    <ul></ul> {# содержимое будет заменено через JS #}
  </nav>
</div>

{# шаблон контента мобильного меню в стиле Figma #}
<script type="text/template" id="oa-mobile-menu-template">
  <div class="oa-mm">
    <div class="oa-mm__inner">
      <!-- верх: логотип + крестик -->
      <div class="oa-mm__top">
        <a class="hero-brand oa-mm__logo" href="/">
          <img class="hero-mark" width="51" height="101"
               src="https://andreyegorov.com/luxreal/wp-content/uploads/2025/10/479ca7c85bb1e2e8fdf70efdeb5d0b6e.png"
               alt="One Agency">
          <span class="hero-name">One Agency</span>
        </a>

        <button type="button" class="oa-mm__close" aria-label="Close menu">✕</button>
      </div>

      <!-- три колонки меню -->
      <div class="oa-mm__columns">
        <div class="oa-mm__col">
          <a href="#" class="oa-mm__link">About us</a>
          <a href="{% url 'about' %}" class="oa-mm__link">About Bali</a>
          <a href="#" class="oa-mm__link">Map</a>
          <a href="#" class="oa-mm__link">FAQ</a>
          <a href="#" class="oa-mm__link">Reviews</a>
          <a href="#" class="oa-mm__link">Partners</a>
          <a href="#" class="oa-mm__link">Contacts</a>
        </div>

        <div class="oa-mm__col">
          <div class="oa-mm__col-title">Our projects</div>
          <a href="#" class="oa-mm__link">Apartments</a>
          <a href="#" class="oa-mm__link">Villas</a>
          <a href="#" class="oa-mm__link">Townhouses</a>
          <a href="#" class="oa-mm__link">Land plots</a>
        </div>

        <div class="oa-mm__col">
          <div class="oa-mm__col-title">Concierge service</div>
          <a href="#" class="oa-mm__link">Accommodation</a>
          <a href="#" class="oa-mm__link">Transportation</a>
          <a href="#" class="oa-mm__link">Legal support</a>
          <a href="#" class="oa-mm__link">Travel</a>
        </div>
      </div>

      <!-- блок контактов -->
      <div class="oa-mm__contacts">
        <div class="oa-mm__contacts-title">
          <span class="oa-mm__dot"></span>
          <span>Request details</span>
        </div>
        <div class="oa-mm__contacts-text">Call us: +62 822 663 61 606</div>
        <div class="oa-mm__contacts-text">Email us: one.agency.bali@gmail.com</div>
        <a href="#" class="oa-mm__contacts-link">Instagram RU</a>
        <a href="#" class="oa-mm__contacts-link">Instagram ENG</a>
      </div>

      <!-- низ: избранное + Order a call -->
      <div class="oa-mm__bottom">
        <a href="#" class="favorites-btn" aria-label="Favorites">
          <img src="{% static 'images/save_icon.svg' %}" alt="Favorites" class="favorites-icon">
        </a>

        <a href="#contact"
           class="oa-mm__button">
          Order a call
          <i class="wdt-button__icon" aria-hidden="true"></i>
        </a>
      </div>
    </div>
  </div>
</script>

<style>
  /* ---------- HEADER: логотип + избранное + бургер ---------- */

  .mobilie_header_nav .mobile_menu_bar {
    padding: 10px 0;
  }

  .hero-brand.mobile_logo {
    display: flex;
    align-items: center;
    gap: 8px;
    text-decoration: none;
  }

  .hero-brand .hero-mark {
    display: block;
    height: 32px;
    width: auto;
  }

  .hero-brand .hero-name {
    font-family: 'Manrope', sans-serif;
    font-weight: 600;
    font-size: 18px;
    line-height: 1;
    background: linear-gradient(
      90deg,
      #F0987D 0%,
      #CE7F63 16.83%,
      #FFBEA4 28.85%,
      #CF795F 60.1%,
      #FFAC93 69.71%,
      #D7785B 83.65%,
      #EA9278 97.12%
    );
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
  }

  .mobile_menu_actions {
    margin-left: auto;
    gap: 8px;
  }

  .favorites-btn {
    display: flex;
    justify-content: center;
    align-items: center;
    width: 35px;
    height: 35px;
    border-radius: 25px;
    background: rgba(255, 255, 255, 0.08);
    border: 0.25px solid #656565;
    box-shadow: 2px 1px 7.5px rgba(0, 0, 0, 0.5);
    backdrop-filter: blur(1.25px);
    text-decoration: none;
  }

  .favorites-btn .favorites-icon {
    display: block;
    width: 16px;
    height: 16px;
  }

  .mobile-burger {
    display: flex;
    justify-content: center;
    align-items: center;
    width: 35px;
    height: 35px;
    border-radius: 72px;
    background: linear-gradient(
      90deg,
      #F0987D 0%,
      #CE7F63 16.83%,
      #FFBEA4 28.85%,
      #CF795F 60.1%,
      #FFAC93 69.71%,
      #D7785B 83.65%,
      #EA9278 97.12%
    );
    box-shadow: 2px 1px 7.5px rgba(0, 0, 0, 0.5);
    filter: drop-shadow(2px 1px 7.5px rgba(0, 0, 0, 0.5));
  }

  .mobile-burger img {
    display: block;
  }

  /* ---------- ПЕРЕОПРЕДЕЛЕНИЯ ДЛЯ MMENU ---------- */

  #menu.mm-menu {
    background: transparent;
  }

  #menu.mm-menu .mm-panel {
    padding: 0;
  }

  /* ---------- НОВОЕ МОБИЛЬНОЕ МЕНЮ (Figma-стиль) ---------- */

  .oa-mm {
    position: relative;
    width: 390px;
    max-width: 100%;
    height: 563px;
    background: #232323;
    border-radius: 0 0 25px 25px;
    overflow: hidden;
    margin: 0 auto;
  }

  .oa-mm__inner {
    position: relative;
    width: 100%;
    height: 100%;
    padding: 40px 20px 20px;
    box-sizing: border-box;
    color: #ffffff;
    font-family: 'Manrope', sans-serif;
  }

  .oa-mm__top {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: 24px;
  }

  .oa-mm__logo {
    display: flex;
    align-items: center;
    gap: 8px;
    text-decoration: none;
  }

  .oa-mm__close {
    background: none;
    border: 1px solid #FFFFFF;
    width: 21px;
    height: 21px;
    border-radius: 50%;
    color: #FFFFFF;
    font-size: 13px;
    line-height: 1;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
  }

  .oa-mm__columns {
    display: flex;
    gap: 30px;
    margin-bottom: 30px;
  }

  .oa-mm__col {
    display: flex;
    flex-direction: column;
    gap: 5px;
    font-size: 15px;
  }

  .oa-mm__col-title {
    font-weight: 600;
    color: #A0A0A0;
    margin-bottom: 4px;
  }

  .oa-mm__link {
    color: #FFFFFF;
    text-decoration: none;
    font-weight: 600;
  }

  .oa-mm__link:hover {
    text-decoration: underline;
  }

  .oa-mm__contacts {
    margin-top: 10px;
    margin-bottom: 20px;
  }

  .oa-mm__contacts-title {
    display: flex;
    align-items: center;
    gap: 8px;
    font-weight: 600;
    font-size: 16px;
    margin-bottom: 12px;
  }

  .oa-mm__dot {
    width: 8px;
    height: 8px;
    border-radius: 50%;
    background: linear-gradient(
      90deg,
      #F0987D 0%,
      #CE7F63 16.83%,
      #FFBEA4 28.85%,
      #CF795F 60.1%,
      #FFAC93 69.71%,
      #D7785B 83.65%,
      #EA9278 97.12%
    );
  }

  .oa-mm__contacts-text {
    font-size: 16px;
    font-weight: 600;
    color: #A0A0A0;
    margin-bottom: 4px;
  }

  .oa-mm__contacts-link {
    display: block;
    font-size: 16px;
    font-weight: 600;
    color: #FFFFFF;
    text-decoration: none;
  }

  .oa-mm__bottom {
    position: absolute;
    left: 20px;
    right: 20px;
    bottom: 20px;
    display: flex;
    align-items: center;
    gap: 12px;
  }

  .oa-mm__bottom .favorites-btn {
    width: 35px;
    height: 35px;
  }

  .oa-mm__button {
    flex: 1;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    gap: 6px;
    height: 35px;
    padding: 7px 15px;
    border-radius: 25px;
    font-size: 12px;
    font-weight: 600;
    text-decoration: none;
    color: #FFFFFF;
    background: linear-gradient(
      90deg,
      #F0987D 0%,
      #CE7F63 16.83%,
      #FFBEA4 28.85%,
      #CF795F 60.1%,
      #FFAC93 69.71%,
      #D7785B 83.65%,
      #EA9278 97.12%
    );
    box-shadow: 2px 1px 7.5px rgba(0, 0, 0, 0.5);
  }
</style>

<script>
  // ожидаем jQuery и mmenu
  jQuery(function ($) {
    var $menu = $('#menu');

    function enhanceMenu() {
      var api = $menu.data('mmenu');
      if (!api) {
        return false;
      }

      api.bind('open:after', function () {
        var $panel = $menu.find('.mm-panel').first();

        // чтобы не пересоздавать при каждом открытии
        if ($panel.data('oa-built')) {
          return;
        }
        $panel.data('oa-built', true);

        // очищаем стандартный navbar + список и вставляем свой шаблон
        $panel.empty();
        $panel.append($('#oa-mobile-menu-template').html());

        // обработчик на крестик
        $panel.on('click', '.oa-mm__close', function (e) {
          e.preventDefault();
          api.close();
        });
      });

      return true;
    }

    // ждём, пока тема/скрипты инициализируют mmenu
    (function waitForMMenu() {
      if (!enhanceMenu()) {
        setTimeout(waitForMMenu, 100);
      }
    })();
  });
</script>

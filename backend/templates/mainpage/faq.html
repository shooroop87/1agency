{% load static i18n %}
<section class="our-faq pt-0 pb90 section-content" id="faq">
  <div class="container">
    <div class="row align-items-start">
      
      <!-- Left Column -->
      <div class="col-lg-4">
        <div class="mb25 faq-eyebrow">{% trans "FAQ" %}</div>
        <h2 class="mb30 faq-title">{% trans "Most popular questions" %}</h2>
        <a href="#" class="wdt-button button-cta3 is-sm open-faq-modal">
          {% trans "Submit a question" %} <span class="wdt-button__icon"></span>
        </a>
      </div>

      <!-- Right Column - Accordion -->
      <div class="col-lg-8 mt50-xs">
        <div class="accordion" id="faqAccordion">

          {% for faq in faqs %}
          <div class="accordion-item mb10 faq-card">
            <h2 class="accordion-header" id="q{{ faq.id }}">
              <button class="accordion-button {% if not forloop.first %}collapsed{% endif %}" 
                      type="button"
                      data-bs-toggle="collapse" 
                      data-bs-target="#a{{ faq.id }}"
                      aria-expanded="{% if forloop.first %}true{% else %}false{% endif %}" 
                      aria-controls="a{{ faq.id }}">
                <span class="faq-dot"></span>
                {{ faq.question }}
                <span class="faq-pill"><i class="fal fa-plus" aria-hidden="true"></i></span>
              </button>
            </h2>
            <div id="a{{ faq.id }}" 
                 class="accordion-collapse collapse {% if forloop.first %}show{% endif %}" 
                 aria-labelledby="q{{ faq.id }}" 
                 data-bs-parent="#faqAccordion">
              <div class="accordion-body">
                {{ faq.answer|safe }}
              </div>
            </div>
          </div>
          {% empty %}
          <p class="text-muted">{% trans "No FAQs available" %}</p>
          {% endfor %}

        </div>
      </div>
    </div>
  </div>
</section>

<style>
  /* FAQ Question Modal */
.question-modal {
  position: fixed;
  inset: 0;
  width: 100%;
  height: 100%;
  z-index: 9999;
  display: none;
  opacity: 0;
  transition: opacity 0.3s ease;
}

.question-modal.is-active {
  display: flex;
  align-items: center;
  justify-content: center;
  opacity: 1;
}

.question-modal__overlay {
  position: absolute;
  inset: 0;
  background: rgba(0, 0, 0, 0.85);
  backdrop-filter: blur(8px);
}

.question-modal__content {
  position: relative;
  width: 442px;
  max-width: 95%;
  max-height: 90vh;
  background: #222222;
  border-radius: 30px;
  padding: 50px 40px 40px;
  z-index: 1;
  overflow-y: auto;
}

.question-modal__close {
  position: absolute;
  top: 20px;
  right: 20px;
  width: 21px;
  height: 21px;
  background: transparent;
  border: none;
  cursor: pointer;
  padding: 0;
  transition: transform 0.2s;
}



.question-modal__header {
  margin-bottom: 30px;
  text-align: center;
}

.question-modal__title {
  font-family: 'Manrope', sans-serif;
  font-weight: 400;
  font-size: 20px;
  line-height: 130%;
  color: #FFFFFF;
  margin: 0;
}

/* поля формы */
.question-form__field {
  margin-bottom: 15px;
}

.question-form__field input,
.question-form__field textarea {
  width: 100%;
  background: rgba(255, 255, 255, 0.9);
  border-radius: 30px;
  border: none;
  padding: 15px 25px;
  font-family: 'Manrope', sans-serif;
  font-weight: 400;
  font-size: 14px;
  color: #000;
  resize: none;
}

.question-form__field input {
  height: 50px;
}

.question-form__field textarea {
  min-height: 120px;
  border-radius: 25px;
}

.question-form__field input::placeholder,
.question-form__field textarea::placeholder {
  color: rgba(0, 0, 0, 0.5);
}

/* чекбокс */
.question-form__checkbox {
  margin: 20px 0 25px;
}

.question-form__checkbox label {
  display: flex;
  align-items: flex-start;
  gap: 10px;
  cursor: pointer;
  font-family: 'Manrope', sans-serif;
  font-weight: 400;
  font-size: 13px;
  color: #FFFFFF;
}

.question-form__checkbox input[type="checkbox"] {
  display: none;
}

.question-form .checkbox-custom {
  position: relative;
  width: 18px;
  height: 18px;
  border: 1.5px solid rgba(255, 255, 255, 0.6);
  border-radius: 4px;
  flex-shrink: 0;
  margin-top: 2px;
  transition: all 0.3s;
}

.question-form__checkbox input[type="checkbox"]:checked + .checkbox-custom {
  background: linear-gradient(90deg, #F0987D 0%, #CE7F63 16.83%, #FFBEA4 28.85%, #CF795F 60.1%, #FFAC93 69.71%, #D7785B 83.65%, #EA9278 97.12%);
  border-color: transparent;
}

.question-form__checkbox input[type="checkbox"]:checked + .checkbox-custom::after {
  content: '✓';
  position: absolute;
  inset: 50% auto auto 50%;
  transform: translate(-50%, -50%);
  color: #fff;
  font-size: 12px;
  font-weight: 700;
}

.question-form__submit {
  width: 100%;
  height: 50px;
  background: linear-gradient(90deg, #F0987D 0%, #CE7F63 16.83%, #FFBEA4 28.85%, #CF795F 60.1%, #FFAC93 69.71%, #D7785B 83.65%, #EA9278 97.12%);
  border-radius: 50px;
  border: none;
  font-family: 'Manrope', sans-serif;
  font-weight: 600;
  font-size: 16px;
  color: #FFFFFF;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 10px;
  transition: transform 0.2s, box-shadow 0.2s;
}

.question-form__submit:hover {
  transform: translateY(-2px);
  box-shadow: 0 4px 15px rgba(240, 152, 125, 0.4);
}

.question-form__submit svg {
  width: 16px;
  height: 16px;
}

/* кастомный скролл */
.question-modal__content::-webkit-scrollbar {
  width: 6px;
}

.question-modal__content::-webkit-scrollbar-track {
  background: rgba(0, 0, 0, 0.2);
  border-radius: 0 30px 30px 0;
}

.question-modal__content::-webkit-scrollbar-thumb {
  background: linear-gradient(180deg, #F0987D 0%, #CE7F63 50%, #EA9278 100%);
  border-radius: 10px;
}

/* Firefox */
.question-modal__content {
  scrollbar-width: thin;
  scrollbar-color: #E08A72 rgba(0, 0, 0, 0.2);
}

/* Mobile */
@media (max-width: 767px) {
  .question-modal__content {
    width: 100%;
    max-width: 100%;
    max-height: 100vh;
    border-radius: 20px;
    padding: 40px 25px 30px;
  }

  .question-modal__title {
    font-size: 18px;
  }

  .question-form__field textarea {
    min-height: 90px;
  }
}
/* по умолчанию блок успеха скрыт */
.question-modal__success {
  display: none;
  width: 100%;
  height: 100%;
}

.question-modal__success-inner {
  height: 100%;
  min-height: 260px;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  text-align: center;
}

.question-modal__success-title {
  font-family: 'Manrope', sans-serif;
  font-weight: 400;
  font-size: 20px;
  line-height: 130%;
  color: #FFFFFF;
  margin: 0 0 8px;
}

.question-modal__success-text {
  font-family: 'Manrope', sans-serif;
  font-weight: 400;
  font-size: 16px;
  line-height: 130%;
  color: rgba(255, 255, 255, 0.8);
  margin: 0 0 24px;
}

.question-modal__success-btn {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  gap: 10px;
  padding: 12px 26px;
  border-radius: 50px;
  text-decoration: none;
  border: none;
  font-family: 'Manrope', sans-serif;
  font-weight: 600;
  font-size: 14px;
  color: #FFFFFF;
  background: linear-gradient(90deg, #F0987D 0%, #CE7F63 16.83%, #FFBEA4 28.85%, #CF795F 60.1%, #FFAC93 69.71%, #D7785B 83.65%, #EA9278 97.12%);
  cursor: pointer;
  transition: transform 0.2s, box-shadow 0.2s;
}

.question-modal__success-btn:hover {
  transform: translateY(-2px);
  box-shadow: 0 4px 15px rgba(240, 152, 125, 0.4);
}

.question-modal__success-btn svg {
  width: 16px;
  height: 16px;
}

/* на мобилке чуть меньше */
@media (max-width: 767px) {
  .question-modal__success-title {
    font-size: 18px;
  }
  .question-modal__success-text {
    font-size: 14px;
  }
}
/* FAQ Accordion Fix */
.accordion-button {
  position: relative;
  z-index: 1;
  pointer-events: auto;
  cursor: pointer;
}

.faq-card {
  position: relative;
  z-index: 1;
}

.our-faq {
  position: relative;
  z-index: 2;
}
</style>
<script>
document.addEventListener('DOMContentLoaded', function() {
  const faqModal   = document.getElementById('faqQuestionModal');
  if (!faqModal) return;

  const openFaqBtns   = document.querySelectorAll('.open-faq-modal');
  const closeFaqBtn   = faqModal.querySelector('.question-modal__close');
  const faqOverlay    = faqModal.querySelector('.question-modal__overlay');
  const faqForm       = document.getElementById('faqQuestionForm');
  const faqBody       = document.getElementById('faqQuestionBody');
  const faqSuccess    = document.getElementById('faqQuestionSuccess');

  function resetFaqState() {
    if (faqForm) faqForm.reset();
    if (faqBody) faqBody.style.display = 'block';
    if (faqSuccess) faqSuccess.style.display = 'none';
  }

  function openFaqModal(e) {
    if (e) e.preventDefault();
    resetFaqState();
    faqModal.classList.add('is-active');
    document.body.style.overflow = 'hidden';
  }

  function closeFaqModal() {
    faqModal.classList.remove('is-active');
    document.body.style.overflow = '';
  }

  openFaqBtns.forEach(btn => {
    btn.addEventListener('click', openFaqModal);
  });

  if (closeFaqBtn) closeFaqBtn.addEventListener('click', closeFaqModal);
  if (faqOverlay)  faqOverlay.addEventListener('click', closeFaqModal);

  document.addEventListener('keydown', function(e) {
    if (e.key === 'Escape' && faqModal.classList.contains('is-active')) {
      closeFaqModal();
    }
  });

  if (faqForm) {
    faqForm.addEventListener('submit', function(e) {
      e.preventDefault();

      const formData = new FormData(faqForm);
      const data = {
        name:    formData.get('name'),
        phone:   formData.get('phone'),
        email:   formData.get('email'),
        message: formData.get('message'),
        privacy: formData.get('privacy')
      };

      // TODO: сюда добавь реальную отправку на сервер (fetch / AJAX / Django view)
      console.log('FAQ question form data:', data);

      // Показываем экран успеха
      if (faqBody)    faqBody.style.display = 'none';
      if (faqSuccess) faqSuccess.style.display = 'block';
    });
  }
});
</script>
